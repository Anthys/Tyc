-- title:  game title
-- author: game developer
-- desc:   short description
-- script: lua

-- big sword has been stolen
-- take small sword, and retrieve it to restore stability to the Kingdom

-- the small sword is actually comically very big
-- the big sword is enormous, size of the tower
-- you have to climb a tower to find the big sword
-- each time a new type of enemy appears, it is introduced by a zoom and a vignette around it, its name appearing below it

-- game in top down hack slasher
-- when a panel is cleared, an arrow shows the direction toward which you have to continue

--game starts in a room with player in center, monster trying to enter everywhere
-- a wall breaks at the left, monster enters, an arrow blinks to push the player toward the right
-- the sword is in the middle of the next room,  the player can take it 

-- can choose capacities to use (like round), which changes the color of one side of the sword

--particles, lights emmitted by the center of the rooms during the beginning rooms

function lerp(a,b,t) return (1-t)*a + t*b end
cos,sin,abs,atan2,sqrt=math.cos,math.sin,math.abs,math.atan2,math.sqrt
random = math.random
PI=math.pi 
t=0
tt=0
x=96
y=24
g={
	st=2,
	stage=1,
	step=1,
	counter=0
}

ST = {"intro", "begin"}
p={
	x=120,
	y=68,
	vx=0,
	vy=0,
	dir = {x=1,y=0},
	r=3,
	sw = {
		active = false,
		anim = {
			cd = 0,
			cdmax=1,
			active=false,
			frame=0,
			x0=0,
			y0=0,
			angle0=0,
			name="",
			oth1 = 0
		},
		x=120,
		y=60,
		h=40,
		lrp_p=.1,
		lrp_a=.06,
		angle=PI
	}
}

cam={
	x=0,
	y=0,
	tx=0,
	ty=0,
	lrp=.2
}

ents = {}

function TIC()
	_G[ST[g.st]]()
	t=t+1
	tt=tt+1
end

function intro()
	cls(0)
	print("big sword was stolen", 0, 0)
	if btnp(4) then g.st = 2 tt=0 end	
	if tt>30 then print("take small sword and retrieve big sword", 0, 10)
	if tt>60 then print("restore stability and save the world", 0, 20)
	if tt>90 then print("thks", 0, 30)
	if tt>120 then 	
		if tt%100<50 then print("press z", 100, 110, 1) end
	end end end end
end
rangsave = 1
function my_rand(a)
	a = a or rangsave
	local m1 =7247
	local m2 = 7823
	rangsave = (a*a)%(m1*m2)
	return rangsave/(m1*m2)
end

function cool_background()
	local a = 2
	if a==1 then
		my_rand(1234567890)
		for i=1,200,1 do
			local angle = my_rand()*2*PI
			local dist = (my_rand()*200+t*(1+my_rand()))%200
			circ(120+cos(angle)*dist-cam.x, 68+sin(angle)*dist-cam.y, my_rand()*2+1,11+my_rand()*2)		
		end
	elseif a==2 then
		my_rand(1234567890)
		local angle = -PI/2-PI/7 - PI/2
		for i=1,200,1 do
			local start = my_rand()*300
			local dist = (my_rand()*400+t*(1+my_rand()))%400
			circ(start+70+cos(angle)*dist-cam.x, start*.5-100+sin(angle)*dist-cam.y, my_rand()*2+1,11+my_rand()*2)		
		end
	end
end

function begin()
	cls()
	update_cam()
	--cam.x=p.x cam.y=p.y
	local ccx=cam.x//8--+(cam.x%8==0 and 1 or 0)
	local ccy=cam.y//8--+(cam.y%8==0 and 1 or 0)
	--print(cam.x, 0,0)
	--print(ccx, 0,10)
	map(ccx,ccy,31,18,-(cam.x%8),-(cam.y%8),0)
	if g.step ==1 then
		rect(-cam.x, -cam.y, 241,137,0)
		cool_background()
		map(0,2*136//8,31,18,-cam.x,-cam.y,0)
		map(240//8,2*136//8,31,18,240-cam.x,-cam.y,-1)
	elseif g.step==3 then
		spr(264,30-math.floor(cam.x),120-math.floor(cam.y),0,2,0,0,4,4)
		spr(264,100-math.floor(cam.x),30-math.floor(cam.y),0,1,1,0,4,4)
		spr(264,200-math.floor(cam.x),150-math.floor(cam.y),0,1,0,0,4,4)
	end

	if p.x < 240 and p.y < 136 and g.step==1 then 
		print("small sword ->", 120-cam.x, 60-cam.y)
		if tt%50==0 and false then 
			local a = random(0,1)
			local x = (1-a)*random(240)
			local y = (1-a)*random(0,1)*136+ a*random(136)
			ents[#ents+1] = newBlob(x,y) end
	end
	if not p.sw.active and p.x < 240*2 and p.y <136 and p.x>240 then
		local tim = t/120
		local midsize = 25
		draw_sword(240+120-cam.x-cos(tim)*midsize, 68-cam.y-sin(tim)*midsize, tim)
		if sqrt((p.x-240-120)^2+(p.y-68)^2)<20 then p.sw.active = true end
	end

	draw_michel(cam.x,cam.y)
	if p.sw.active then
		draw_sword(p.sw.x -cam.x, p.sw.y-cam.y, p.sw.angle)
	end

	update_ents()

	actualise()
	process_input()
	--print(p.x, 0,0)
end


function update_ents()
	for i,v in ipairs(ents) do
		--trace(v.spr)
		v:update()
	end
end

Entity = {}
Entity.__index = Entity
function Entity:n(name,health,x,y, spr,v, sx, sy, behaviour, vx, vy, tx, ty, counter_move)
	local tmp = {}
	tmp.h = health or 5
	tmp.name=name or "blob"
	tmp.x = x or 0
	tmp.y = y or 0
	tmp.vx = vx or 0
	tmp.vy = vy or 0
	tmp.v = v or 2
	tmp.spr = spr
	tmp.sx = sx or 5
	tmp.sy = sy or 5
	tmp.tx = tx or 0
	tmp.ty = ty or 0
	tmp.counters = {counter_move={val=0,max=counter or 100}}
	tmp.behaviour = behaviour or "straight"
	setmetatable(tmp, Entity)
	return tmp
end

function Entity:draw()
	if self.spr then 
		spr(self.spr, self.x-cam.x, self.y-cam.y, 0)
	else
		circ(self.x-cam.x, self.y-cam.y, 5,10)
	end
end

function clamp(a,b,c)
	return b<a and a or b>c and c or b
end

function dist(x,y,xx,yy)
	return sqrt((x-xx)^2+(y-yy)^2)
end

function Entity:update()
	if dist(self.x, self.y, self.tx, self.ty) < 2 then
		self.counters.counter_move.val = 0
	end
	if self.counters.counter_move.val==0 then
		self.tx = p.x
		self.ty = p.y
		self.counters.counter_move.val = self.counters.counter_move.max
	end
	self.counters.counter_move.val=self.counters.counter_move.val-1
	self:move()
	self:draw()
end

function Entity:move()
	--[[for i,v in ipairs(ents) do
		if self.x == v.x and self.y == v.y then 
		else 
			local d = dist(self.x, self.y, v.x, v.y)
			local dmax = 10
			if d < dmax then
				local str_repulsion = -1
				local dx = v.x-self.x
				local dy = v.y-self.y
				local norm = sqrt(dx^2+dy^2)
				local Dx = dx/norm*self.v
				local Dy= dy/norm*self.v
				self.vx=self.vx+(dmax-abs(Dx))/dmax*str_repulsion*sign(Dx)
				self.vy=self.vy+(dmax-abs(Dy))/dmax*str_repulsion*sign(Dx)
			end
		end
	end
	]]--
	if self.behaviour == "straight" then
		local dx = self.tx-self.x
		local dy = self.ty-self.y
		local norm = sqrt(dx^2+dy^2)
		local Dx = dx/norm*self.v
		local Dy= dy/norm*self.v
		self.vx=self.vx+Dx
		self.vy=self.vy+Dy
		local str_repulsion = (random(10)+5)*0
		--line(self.x, self.y, self.x+self.vx*10, self.y+self.vy*10,11)
		if not trymove(self, self.x, self.y, self.vx, 0,self.sx, self.sy, .3, true) then
			self.tx=self.x+self.vx+sign(self.vx)*-str_repulsion
		end
		if not trymove(self, self.x, self.y, 0, self.vy,self.sx, self.sy, .3,true) then
			self.ty=self.y+self.vy+sign(self.vy)*-str_repulsion
		end
	end
	local f = .85
	local c = self.v
	self.vx = clamp(-c,self.vx,c)
	self.vy = clamp(-c,self.vy,c)
	self.vx=self.vx*f
	self.vy=self.vy*f
end
--[[
Blob = Entity:n()
Blob.__index = Blob

function Blob:n(health,x,y)
	local n,spr,x,y
	n = "blob"
	health = health or 5
	local tmp = {}
	tmp = Entity:n(n, health, x, y)
	setmetatable(tmp, Entity)
end
]]
function newBlob(x,y)
	local tmp = {}
	local spr = random(0,2)+257
	tmp = Entity:n("blob", 5, x,y, spr, .5, 6,6, "straight")
	return tmp
end

function update_cam()
	if g.stage == 1 then
		if g.step==1 or g.step ==2 then
			if p.x <240 and p.y < 136 then
				cam.tx=0 cam.ty = 0 cam.lrp = .3
			elseif p.x <240*2 then
				cam.tx=240 cam.ty=0 cam.lrp = .3
			elseif p.x >240*2 and p.y < 110 then
				cam.tx=240*2 cam.ty=0 cam.lrp = .3
				if g.counter==0 then g.counter=1 elseif g.counter>0 then g.counter=g.counter+1 end
				if g.counter==20 then g.counter=0 g.step=2 end
			end
		if g.step==2 and p.x<=240*2 or p.x>240*2+60 or p.y>136 then
			g.step = 3
		end
		elseif g.step == 3 then
			if g.counter < 100 then if g.counter==0 then g.counter=1 elseif g.counter>0 then g.counter=g.counter+1 cam.lrp = g.counter/100*.2 end else cam.lrp=.2 end
			cam.x=lerp(cam.x, math.min(240*3+1,math.max(0,p.x-120)),cam.lrp)
			cam.y=lerp(cam.y,math.min(136+1,math.max(0,p.y-64)),cam.lrp)
			return
		end
	end
	cam.x = lerp(cam.x+.1, cam.tx, cam.lrp)
	cam.y = lerp(cam.y+.1, cam.ty, cam.lrp)
end

function process_input()
	local delta = btn(7) and 3 or 1
	if btn(0) then p.vy=-delta end
	if btn(1) then p.vy=delta end
	if btn(2) then p.vx=-delta end
	if btn(3) then p.vx=delta end

	if btnp(4) then anim_sword() end
end

rot = {
			0,-5,1,-5,2,-5,
						3,-4,
								4,-3,
									5,-2,
									5,-1,
									5,0,
									5,1,
									5,2,
								4,3,
						3,4,
	2,5,1,5,0,5,-1,5,-2,5,
						  -3,4,
						  	   -4,3,
									-5,2,
									-5,1,
									-5,0,
									-5,-1,
									-5,-2,
							    -4,-3,
						  -3,-4,
	-2,-5,-1,-5
						 
}

function draw_michel(cx,cy,debug)
	circ(p.x-cx, p.y-cy, p.r, 2)
	circb(p.x-cx, p.y-cy, p.r+1, 0)
	circb(p.x-cx,p.y-cy,p.r+2,3)
	local imax = ((p.sw.anim.cdmax-p.sw.anim.cd)/p.sw.anim.cdmax*27)//1
	for i=0,imax,1 do
		local idx = i*2+1
		pix(p.x+rot[idx]-cx,p.y+rot[idx+1]-cy,4)
	end
	if debug then line(p.x, p.y, p.x+p.dir.x*10,p.y+p.dir.y*10, 5) print(p.sw.angle, 0,0) 
		print(p.sw.anim.cd, 0,10)
		print(imax, 0,20)
	end
end

function actualise()
	--if not trymove(p,p.x,p.y,p.vx,p.vy,p.r,p.r) then 
	--if not trymove(p,p.x,p.y,0,p.vy,p.r,p.r) then
	--trymove(p,p.x,p.y,p.vx,0,p.r,p.r) end end 

	if g.step==1 and g.stage==1 then
		if trymove(p,p.x,p.y+2*136,0,p.vy,p.r,p.r, false, false, true) then p.y=p.y+p.vy end
		if trymove(p,p.x,p.y+2*136,p.vx,0,p.r,p.r, false, false, true) then p.x=p.vx+p.x end
	else
		trymove(p,p.x,p.y,0,p.vy,p.r,p.r)
		trymove(p,p.x,p.y,p.vx,0,p.r,p.r)
	end
	if (p.vx~=0 or p.vy~=0) then
		local norm = math.sqrt(p.vx^2+p.vy^2)
		p.dir.x = p.vx/norm
		p.dir.y=p.vy/norm
	end
	--p.vx=p.vx*.85
	--p.vy=p.vy*.85
	p.vx=0
	p.vy=0

	if not p.sw.anim.active then
		local a1 = math.atan2(p.dir.y, p.dir.x)-PI
		p.sw.angle = abs(-p.sw.angle+a1)<abs(PI*2-p.sw.angle+a1) and p.sw.angle or p.sw.angle-2*PI -- (p.sw.angle<0 and p.sw.angle+2*PI or p.sw.angle-2*PI)
		p.sw.angle = abs(-p.sw.angle+a1)<abs(-PI*2-p.sw.angle+a1) and p.sw.angle or p.sw.angle+2*PI
		--local trgt_angle = abs(-p.sw.angle+a1)>abs(PI*2-p.sw.angle+a1) and a1 or a1+2*PI
		local trgt_angle = a1
		p.sw.angle = lerp(p.sw.angle, trgt_angle, p.sw.lrp_a)
		p.sw.x = lerp(p.sw.x, p.x, p.sw.lrp_p)
		p.sw.y = lerp(p.sw.y, p.y, p.sw.lrp_p)
		if p.sw.anim.cd>0 then p.sw.anim.cd=p.sw.anim.cd-1 end
	else
		local sw = p.sw
		local anim = sw.anim
		local name = anim.name
		if name == "round" then
			local round_duration = 20
			if anim.frame > round_duration then anim.active = false anim.cd=200 anim.cdmax=200 return end
			if anim.frame == 0 then 
				anim.oth1 = math.random(0,1)*2-1
			end
			if anim.frame == round_duration//2 then
				for i=#ents, 1, -1 do
					v = ents[i]
					if dist(v.x, v.y, sw.x, sw.y) < sw.h then
						table.remove(ents, i)
					end
				end
			end
			sw.angle = anim.frame/round_duration*2*PI*anim.oth1 + anim.angle0
			p.sw.x = lerp(p.sw.x, p.x, p.sw.lrp_p)
			p.sw.y = lerp(p.sw.y, p.y, p.sw.lrp_p)
			anim.frame=anim.frame+1
		end

	end
end

function sign(a)
	return a>=0 and 1 or -1
end

BLOCKS_BLOCKS = {[1]=1, [48]=1, [49]=1,[51]=1,[50]=1,[65]=1,[66]=1,[67]=1,[81]=1,[17]=1,[18]=1}

function trymove(obj,x,y,vx,vy,sx,sy, dlerp,check_ents, no_modif) --rewrite with only obj?
	local xx = (x+vx+sign(vx)*sx)//8
	local yy = (y+vy+sign(vy)*sy)//8
	local xx2 = (x+vx)//8
	local yy2 = (y+vy)//8
	if t_is_in(BLOCKS_BLOCKS, mget(xx, yy)) or t_is_in(BLOCKS_BLOCKS,mget(xx2,yy2)) then 
		return false 
	else
		if check_ents then
			for i,v in ipairs(ents) do
				if v.x==obj.x and v.y == obj.y then else
					if abs(x+vx-v.x)<v.sx and abs(y+vy-v.y)<v.sy  then return false end
				end
			end
		end
		if not no_modif then
			if dlerp then 
				obj.x, obj.y = lerp(obj.x, x+vx, dlerp), lerp(obj.y, y+vy, dlerp)
			else obj.x, obj.y = x+vx, y+vy end
		end
		return true 
	end
end

function anim_sword(name)
	local sw = p.sw
	local anim = sw.anim
	if anim.active or anim.cd>0 then return end
	anim.active = true
	local name = "round"
	anim.name = name
	anim.frame = 0
	anim.angle0 = sw.angle
	anim.x0 = sw.x0
	anim.y0 = sw.y0
end

function draw_sword(x,y,angle,border)
	local x0,y0,x1,y1,x2,y2,x3,y3,x4,y4,x5,y5,x6,y6,x7,y7,x8,y8,a,b,c,d,e
	local a,b,c,d,e=10,4,8,30,8

	x5,y5=x,y
	
	x4,y4 = x5+cos(angle)*a, y5+sin(angle)*a
	
	x6,y6=x4+cos(angle-PI/2)*(b+c/2),y4+sin(angle-PI/2)*(b+c/2)
	x3,y3=x4+cos(angle+PI/2)*(b+c/2),y4+sin(angle+PI/2)*(b+c/2)

	x2,y2=x4+cos(angle+PI/2)*(c/2),y4+sin(angle+PI/2)*(c/2)
	x7,y7=x4+cos(angle-PI/2)*(c/2),y4+sin(angle-PI/2)*(c/2)

	x1,y1=x2+cos(angle)*d,y2+sin(angle)*d
	x8,y8=x7+cos(angle)*d,y7+sin(angle)*d

	local dist = math.sqrt(e*e-c*c/4)
	x0,y0=(x1+x8)/2+cos(angle)*dist,(y1+y8)/2+sin(angle)*dist

	cx,cy = 0,0
	line(x5-cx,y5-cy,x4-cx,y4-cy,0)
	line(x3-cx,y3-cy,x6-cx,y6-cy,0)
	if border then
	line(x2,y2,x1,y1,3)
	line(x7,y7,x8,y8,3)
	line(x1,y1,x0,y0,4)
	line(x8,y8,x0,y0,4)
	else
		tri(x2-cx,y2-cy,x1-cx,y1-cy,x7-cx,y7-cy,15)
		tri(x7-cx,y7-cy,x8-cx,y8-cy,x1-cx,y1-cy,0)
		tri(x8-cx,y8-cy,x0-cx,y0-cy,x1-cx,y1-cy,0)
	end
	
end


--      x0 y0
-- x8 y8 / \ x1 y1
--       | |
--  x7y7 | | x2 y2
--x6 y6  ___ x3 y 3
--        | x4 y4
--      x5 y5

--      
--       / \ e
--       | |d
--       |c| 
--       ___ b
--        | a
--     
-- c is the length inside the sword, b is what is outside

--UTILITY

function t_is_in(t, e)
	if t[e] ~= nil then return true else return false end
end

-- <TILES>
-- 001:0bbaaaa0b8899999b9898988a9988998a8998998a9898999a999988809988898
-- 002:2222222222222222222222222222222222222222222222222222222222222222
-- 003:eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
-- 004:5555555556556676566666665566766656776666567766675567666665666766
-- 005:5555555666556555766667656666676566676675666666676766776567666655
-- 006:6566667667676655677676666767666667776776667776766567667775676776
-- 007:6665665776656776667767666666666677666677677677765567767667666556
-- 008:eeeeeee6eeeeee6eeeeeeeeeeee6eee6eee66e66ee6eee6eeeeee6eeeeeeee66
-- 009:eee6ee66e66666eeee666e66e6666666ee66e666eee66e6666e6ee66ee666666
-- 013:0000000000440000002220000202020002222440022444400422222222424422
-- 014:0000000000000000020020020222220202022222022202420222222422222222
-- 015:0000000000000000000000000000000000422200024202220202244222222244
-- 017:eeeeeeeeee0dd0eee0dddd0ee0d00d0ee0dddd0ee00dd00eeeddddeeeeeeeeee
-- 018:eeeeeeeeeeffffeeefeffefeeffeeffeeffeeffeefeffefeeeffffeeeeeeeeee
-- 019:dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd
-- 020:5556667657576676577666665766766656766666567666675566556655565555
-- 021:6766665567667765666666676667655566665555776655556677555555557755
-- 022:7676766667677775677667667756777667756766767767767777767767666656
-- 023:7767677666666667667676766667667667767766767766666766675565667677
-- 024:eeeeeeeeeeee6ee6eee6ee67eeee6666eeeeee67eeeeee66eeeee66eeeeeee66
-- 025:ee66666666e66666ee666e66eee66666eee66666ee6eee66eeeee6eeeeeeee66
-- 036:5666766755667766556667665766766656776667556776676566766656666776
-- 037:5555555555566665567766666666667666677666665666666756677766756666
-- 038:7666665566777775766666656666556566677555666767556766767567667665
-- 039:6666676577677666666667766667667767776567666655676575555655555555
-- 040:7777667776676666776666666766dddd6665dddc56665ddc56665dcc566655dc
-- 041:766776766776667666666666ddd66676cddd6576cddd6676ccdd6677cddd6667
-- 048:999999999a8888899aa888899baa888998baa889988baa899888aaa999999999
-- 049:2225522255255525665566555556656555665666565655655666555666555555
-- 050:5555556665556665565565656665665556566555556655665566555622565256
-- 051:6555565266655655565655225666655555556655555656555566655256565552
-- 052:5666766755667766556667665766766656776667556776676566766656666776
-- 053:5555555555566565657666556676666666667666667676666666777766766777
-- 054:7666665566777775766666656666556566677555666767556766767567667665
-- 055:6666676577677666666667766667667767776567666655676575555655555555
-- 056:55655ddc6556dddd6656dddd6656666d66556666766677666777767666666777
-- 057:cddd6566dddd5666ddd55666dd65666666656776666677667677666676777666
-- 065:5555656555566655556565555566555565566565566565655565556655555556
-- 066:5565556555665555655566555666556556555566665655656655655555666555
-- 067:5556556665555556565555556665655555565655556655665555555655555665
-- 081:5555555555555555665566555556656555665666565655655666555666555555
-- 100:99aaaaaaa9999aa9aa8aa88a99aa88a8a89aa99a8aa9aaaaa988889aa88aa8aa
-- 101:9aaaaaaa99a98a98a9aa9aaaa9aaaa8aa988aaaaa88a9a88a8aaaa9aaaa8aaaa
-- 116:99aaaaaaa9999aa9aa8aa88a99aa88a8a89aa99a8aa944a4a4444c4444c44c44
-- 117:aa9aaa999aa9a99aa9aaaa9aa9a99999aa99a9894a444aa834c444aa44343c4a
-- 132:44444444434443344443c4444444cc44c3c34c344c444c444cc3444443444344
-- 133:4444444443444334444344444444434443334434444443444443444443444344
-- </TILES>

-- <SPRITES>
-- 001:0000000000440000002220000202020002222440022444400422222222424422
-- 002:0000000000000000020020020222220202022222022202420222222422222222
-- 003:0000000000000000000000000000000000422200024202220202244222222244
-- 008:000000000000000000000000000000000000000f000000ff0000fff60000f6f7
-- 009:00000000000fffff00ff66760ff60777ff607776667766676666676777667522
-- 010:00000000ffff0000777fffff660777ff66677777777766705757666660766666
-- 011:0000000000000000ffffff0077777ff0777777f0706666ff6607667f6777766f
-- 024:0000f777000ff667000f7766000f7766000f7776000f767600ff777500f67655
-- 025:7666722366577222667055222266666523366666677676666666677677666666
-- 026:3266776632676756665667576767666666666262757565326655522266666666
-- 027:7676660f6066660f7666666f6606606f266666ff276606f026606ff067622f00
-- 040:0ff676750f6622660f6227670f6237770ff222760f6067720ff6f66200fffff6
-- 041:5622266556222666666667576677566676666677232667662226677722666d7e
-- 042:7566576066666766266666672326667622222766667226666d67606fed0006ff
-- 043:66732f0062222f0072222f00666fff0066ff0000fff00000f000000000000000
-- 056:000000ff00000000000000000000000000000000000000000000000000000000
-- 057:ffffddee000fdded00ffddee00fddede0ffdeede0fdeeedeffeeeedefeeeeeee
-- 058:e6006ff0e666ff00edfff000dff00000ddff0000eddff000edddff00eeeedf00
-- </SPRITES>

-- <MAP>
-- 000:341534343424341524152415241534242424242424242424242424242424341534343424341524152415241534242424243415343434243415241524341534343424341524152415241534242434243415241524152415342424342434152415241524153424243424341534243415241524152415342424000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 001:345250244052535253525253501540707170502424407070707170707161405250244052535253525253501540707170704052502440525352535252405250244052535253525253501540707170705252525252525252525252525252525252525252525252525252525252525252525252525252525034000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 002:344242526070707171717161605261716170615252717170716170617171437070526070707171717161605261716170617171717170716170617171437070526070707171717161605261716170617171717170716170617171717171617061717171717071617061717171716171617061717171716234000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 003:344270617071616170707070717070706070717161607161706070717161437071707071616170707070717070706070717161607161706070717161437071707071616170707070717070706070717161607161706070717161607170607071716160716170607071716160706070607071716160716234000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 004:344270706171717171707071617061706071707070617171706071707070707161706171717171707071617061706071707070617171706071707070707161706171717171707071617061706071707070617171706071707070617170607170707061717170607170707061706070607170707061716262000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 005:344261707171616071617070607071707070616070617171707070616070707060707171616071617070607071707070616070617171707070616070707060707171616071617070607071707070616070617171707070616070617170707061607061717170707061607061707070707061607061716262000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 006:344260717070706171717070607170717170707070707071717170707070707060717070706171717070607170717170707070707071717170707070707060717070706171717070607170717170707070707071717170707070707071717070707070707171717070707070707170707161617070706234000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 007:344270706160706171717070707061717171716171707171717171716171707070706160706171717070707061717171716171707171717171716171707070706160706171717070707061717171716171707171717171716171707171717171617170717171717171617170716170617171717170716262000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 008:344271707070707070717071717070707071717170606060707071707071717171707070707070717071717070707071717170606060707071707071717171707070707070717071717070707071717170606060707071707071616170707171717060606070707171717060706070717161607161706262000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 009:344271717161717071716171717171617170717171717161717161706171707171717161717071716171717171617170717171717161717161706171707171717161717071716171717171617170717171717161717161706171717171707170707161617070707071616170706071707070617171716262000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 010:344270717171706060606070707171717071707070717171707060707171607070717171706060606070707171717071707070717171707060707171607070717171706060606070707171717071707070717171707060707171616071716170617171717170706171717171707070616070617171716262000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 011:344270707161617070707170707161617161706171717171707060717070707170707161617070707170707161617161706171717171707060717070707170707161617070707170707161617161706171717171707060717070706171706070717161607161707171616071617170707070707071716262000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 012:344270617171717170716170617171717060707171616071617070706160716170617171717170716170617171717060707171616071617070706160716170617171717170716170617171717060707171616071617070706160706171706071707070617171717070706171717171716171707171716262000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 013:344270717161607161706070717161607060717070706171717171707070706070717161607161706070717161607060717070706171717171707070706070717161607161706070717161607060717070706171717171707070707070707070616070617171706160706171717071717170606060706262000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 014:344271707070617171706071707070617070706160706171717171717161706071707070617171706071707070617070706160706171717171717161706071707070617171706071707070617070706160706171717171717161717071717170707070707071707070707071707071616170707170716262000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 015:344270616070617171707070616070617171707070707070717071707071707070616070617171707070616070617171707070707070717071707071707070616070617171707070616070617171707070707070717071707071616170717171716171707171717161717161706171717171707060606262000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 016:344270707070707071717170707070707171717161717071717161706171717170707070707071717170707070707171717161717071717161706171717170707070707071717170707070707171717161717071717161706171717171707071717170717070716161707060707170717070716161706262000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 017:344271616170717161607161607060716161607161617071716160716160707071707071616170707171717170607170707061717171707070617171717171716171707171717171716170717070717070716161707060707171616070717070716171617061717171717060717071617061717171717062000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 018:344271707071616170707070707161617070717070716161707071707071616170706171717171707171717170707061607061717170616070617171716161707070606060707071717171617071617061717171717060717070706171617061717170607071716160716170706170607071716160716162000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 019:344261706171717171707070617171717170617061717171717061706171717171707171616071617071707171717070707070707170707070707071717171717070717070716161707070607070607071716160716170706160706170607071716170607170707061717171707070607170707061717162000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 020:344260707171616071616170717161607161607071716160716160707171616071617070706171717071717171717171617170717171716171707171716160716171617061717171717070607170607170707061717170716161707070607170707070707061607061717171717170707061607061717162000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 021:344260717070706171717171707170707161617070707061717160717070706171716160706171717071707071616170707060606071717170606060707061717170607071716160716170707070707061607061717161717171717070707061607071717070707070717070716161707070707070707162000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 022:344270706160706171717170716170617171717170607061717170706160706171717070707070716161706171717171707170707161617070707061607061717170607170707061717171717071717070707070707171716160716171717070707071717171617171617061717171717071617170717162000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 023:344271707070707070717170706070717161607161707070707171707070707070717161717071717160707171616071616170617171717170717070707070707170707061607061717171717171717171617170717170707061717171717171707170707161617082927082926160716171717060606062000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 024:344271717161717071717171706071707070617171617170717171717161717071717171706060607160717070706171716070717161607161717171617170717171717070707070707170707170707171717060606061607061717170707171716170617171717183937183937082927070716161707062000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 025:344271707071616170707071707070616070617171707071707170707161617070607070707070707170706160706171717071707071616170707171717060606070707071707071616170707071707071616170707070707070707170707170707161617070607161707161617083937070716161707062000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 026:344261706171717171707161717170707070707071706171716170617171717170717171617170717171707070707070717161706171717171707161706171717171707161706171717171707161706171717171707171617170717171706170617171717170617171618292717170618292717171717062000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 027:344260707171616071617060717171716171707171707171706070717161607161707171717060606071717161717071717060707171616071617060707171616071617060707171616071617060707171616071617171717060606071616070717161607161617171718393608292608393716160716162000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 028:344260717070706171717060707071717170606060717070706071707070617171717070706171717070717171706060607060717070706171717060717070706171717060717070706171717060717070706171717060717070706171716071707070617171707071707070618393607170707061717162000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 029:343470706160706171717070706160706171717070706160707070616070617171706160706171717070706160706171717070706160706171717070706160706171717070706160706171717070706160706171717070706160706171717070616070617171707171616070617171707061607061717162000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 030:343471707070707070717171707070707070717171707070717170707070707071707070707070717171707070707070717171707070707070717171707070707070717171707070707070717171707070707070717171707070707070717170707070707071606060707070707071717070707070707162000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 031:347171717161717071717171717161717071717171717161717171716171707171717161717071717171717161717071717171717161717071717171717161717071717171717161717071717171717161717071717171717161717071717171716171707171717171716171707171717171617170717162000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 032:347070717171706060607070717171706060607070717171707071717170606060717171706060607070717171706060607070717171706060607070717171706060607070717171706060607070717171706060607070717171706060607071717170606060707071717170606060707171717060606062000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 033:417272727272727272727272727272727272727272727272727272727272727272727272727272727272727272727272727272727272727272727272727272727272727272727272727272727272727272727272727272727272727272727272727272727272727272727272727272727272727272727251000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 034:000000000000000000000000000000000000000000000000000000000000101010141414151515152434141514143434143434342434341515143434341010104656465646564656465646564656465646564656465646564656580000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 035:000000000000000000000000000000000000000000000000000000000000101010241424243434153415153424343424142414242414142434341515401010104747574757475747574757475747574757475747574757475747570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 036:000000000000000000000000000000000000000000000000000000000000101010141424243415242414242424343434141415151415241415141434431010105858585858585858585858585858585858585858585858585858580000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 037:000000000000000021212121111111112121212100000000000000000000101010141414141424242424141414141414141414151514141414143424431010105858585858585858585858585858585858585858585858585858580000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 038:000000000000002121313131313131313131312121212121000000000000101010101010101010101010101010101010101010101010101010101010701010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 039:000000000000212131313131313131313131313131313121000000000000101010303030303030303030303030303030303030303030303030303081701010103030303030303030303030303030303030303030303030303030810000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 040:000000000021213131313131313131313131313131313121211010101010101010303030303030303030303030303030303030303030303030303080701010103030303030303030303030303030303030303030303030303030800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 041:000000000021313131313131313131313131313131313131112020202020202020202020202020303030303030303030303030303030303030303090702020202020202020203030303030303030303030303030303030303030900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 042:000000000021313131313131313131313131313131313131312020202020202020202020202020203030303030303030303030303030303030309071712020202020202020202030303030303030303030303030303030303090710000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 043:000000000021313131313131313131313131313131313131312020202020202020202020202020203030303030303030303030303030303030309170702020202020202020202030303030303030303030303030303030303091700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 044:000000000021313131313131313131313131313131313131112020202020202020202020202020303030303030303030303030303030303030303091602020202020202020203030303030303030303030303030303030303030910000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 045:000000000021213131313131313131313131313131313121211010101010101010303030303030303030303030303030303030303030303030303080701010103030303030303030303030303030303030303030303030303030800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 046:000000000000212131313131313131313131313131313121000000000000101010303030303030303030303030303030303030303030303030303081711010103030303030303030303030303030303030303030303030303030810000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 047:000000000000002121313131313131313131312121212121000000000000101010101010101010101010101010101010101010101010101010101010701010101010101010101010101010101010101010101010101010101010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 048:000000000000000021212121111111112121212100000000000000000000101010707170707161617070707070717070716161707070707161617070701010105858585858585858585858585858585858585858585858585858580000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 049:000000000000000000000000000000000000000000000000000000000000101010716170617171717170717071617061717171717070617171717170701010105858585858585858585858585858585858585858585858585858580000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 050:000000000000000000000000000000000000000000000000000000000000101010706070717161607161716170607071716160716170717161607161711010105858585858585858585858585858585858585858585858585858580000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 120:000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007071707071616170700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 121:000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007161706171717171700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 122:000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007060707171616071610000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 123:000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007060717070706171710000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 124:000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007070706160706171710000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 125:000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007171707070707070710000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 126:000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007171717161717071710000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 127:000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007070717171706060600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </MAP>

-- <WAVES>
-- 000:00000000ffffffff00000000ffffffff
-- 001:0123456789abcdeffedcba9876543210
-- 002:0123456789abcdef0123456789abcdef
-- </WAVES>

-- <SFX>
-- 000:000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000304000000000
-- </SFX>

-- <PALETTE>
-- 000:1a1c2c5d275db13e53ef7d57ffcd75a7f07038b76425717929366f3b5dc941a6f673eff7f4f4f494b0c2566c86333c57
-- </PALETTE>

